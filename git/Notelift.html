<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NoteLift</title>
  <link rel="manifest" href="notelift.JSON" />
  <style>
 body {
  font-family: 'Segoe UI', sans-serif;
  background: #f9f9f9;
  color: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

main {
  text-align: center;
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  width: 90%;
  max-width: 500px;
}

button {
  margin: 1rem 0.5rem;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  background-color: #2e7d32;
  color: white;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
}

button:disabled {
  background-color: #aaa;
  cursor: not-allowed;
}

button:hover:not(:disabled) {
  background-color: #1b5e20;
}

pre {
  background: #eee;
  padding: 1rem;
  text-align: left;
  overflow-wrap: break-word;
  border-radius: 8px;
}
</style>
</head>
<body>
  <main>
    <h1>üéôÔ∏è NoteLift</h1>
    <p>Voice-to-Note App for Students & More</p>
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop Recording</button>
    <h3>üìù Transcription:</h3>
    <pre id="transcript">Press start to begin...</pre>
  </main>

  <script>
    let mediaRecorder;
let audioChunks = [];

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const transcriptOutput = document.getElementById("transcript");

startBtn.addEventListener("click", async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
 mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm', audioBitsPerSecond: 128000 });

  audioChunks = [];

  mediaRecorder.ondataavailable = event => {
    audioChunks.push(event.data);
  };

  mediaRecorder.onstop = async () => {
    const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
    const audioFile = new File([audioBlob], "note.webm");

    // Show audio player
const audioURL = URL.createObjectURL(audioBlob);
const audioPlayer = document.createElement("audio");
audioPlayer.controls = true;
audioPlayer.src = audioURL;
document.querySelector("main").appendChild(audioPlayer);

// Save audio download link
const downloadLink = document.createElement("a");
downloadLink.href = audioURL;
downloadLink.download = "note.webm";
downloadLink.textContent = "‚¨áÔ∏è Download Recording";
document.querySelector("main").appendChild(downloadLink);


    transcriptOutput.textContent = "‚è≥ Transcribing...";

    const formData = new FormData();
    formData.append("file", audioFile);
    formData.append("model", "whisper-1");
           
try {
  const response = await fetch("https://api.openai.com/v1/audio/transcriptions", {
    method: "POST",
    headers: {
             Authorization: "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"
      },
    body: formData
  });

  function saveTranscript(text) {
  const previous = JSON.parse(localStorage.getItem("notelift_transcripts") || "[]");
  previous.push({ text, time: new Date().toLocaleString() });
  localStorage.setItem("notelift_transcripts", JSON.stringify(previous));
}


  const data = await response.json();

  if (response.ok && data.text) {
    transcriptOutput.textContent = data.text;
    saveTranscript(data.text); // Save it locally
  } else {
    console.error("Transcription error:", data);
    transcriptOutput.textContent = "‚ùå Failed to transcribe.";
  }
} catch (error) {
  console.error("Fetch error:", error);
  transcriptOutput.textContent = "‚ùå Failed to transcribe (network error).";
}



    transcriptOutput.textContent = data.text || "‚ùå Failed to transcribe.";
  };

  mediaRecorder.start();
  startBtn.disabled = true;
  stopBtn.disabled = false;
});

stopBtn.addEventListener("click", () => {
  mediaRecorder.stop();
  startBtn.disabled = false;
  stopBtn.disabled = true;
});

let timerDisplay = document.createElement('p');
main.appendChild(timerDisplay);
let seconds = 0;
let interval;

startBtn.addEventListener("click", async () => {
  // ...existing setup...

  seconds = 0;
  timerDisplay.textContent = "‚è±Ô∏è 0s";
  interval = setInterval(() => {
    seconds++;
    timerDisplay.textContent = `‚è±Ô∏è ${seconds}s`;
  }, 1000);

  mediaRecorder.start();
  //...
});

stopBtn.addEventListener("click", () => {
  clearInterval(interval);
  mediaRecorder.stop();
});
mediaRecorder.onstart = () => console.log("üé§ Recording started");
mediaRecorder.onstop = () => console.log("üõë Recording stopped");
mediaRecorder.onerror = e => console.error("‚ö†Ô∏è MediaRecorder error:", e);



  </script>
  
  <script>
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log("‚úÖ Service Worker Registered"))
        .catch(err => console.error("SW registration failed:", err));
    }
  </script>
</body>
</html>

    